<div class="mx-auto max-w-[1200px] p-8">
  <header class="mb-12 flex items-center justify-between border-b border-white/5 pb-6">
    <div class="flex items-center gap-4">
      <span class="text-[2.5rem] drop-shadow-[0_0_10px_#6366f1]">üëÅÔ∏è</span>
      <h1
        class="m-0 bg-linear-to-br from-white to-mimir-primary bg-clip-text text-[2rem] font-bold text-transparent"
      >
        Mimir Control
      </h1>
    </div>
    <div class="flex gap-4">
      <button
        class="cursor-pointer rounded-[12px] bg-mimir-primary px-6 py-3 font-semibold text-white shadow-md transition-all duration-200 hover:-translate-y-0.5 hover:bg-mimir-primary-hover disabled:cursor-not-allowed disabled:opacity-50"
        (click)="startDiscovery()"
        [disabled]="scanning()"
      >
        {{ scanning() ? 'Scanning...' : 'Scan Network' }}
      </button>
      <button
        class="cursor-pointer rounded-[12px] border border-white/5 bg-mimir-card p-3 text-white transition-all duration-200 hover:bg-slate-700"
        (click)="refreshDevices()"
      >
        üîÑ
      </button>
    </div>
  </header>

  <main>
    @if (loading() && devices().length === 0) {
      <div class="py-20 text-center">
        <div
          class="mx-auto mb-4 h-10 w-10 animate-spin rounded-full border-4 border-white/5 border-t-mimir-primary"
        ></div>
        <p>Seeking wisdom from the network...</p>
      </div>
    } @else {
      <div class="grid grid-cols-[repeat(auto-fill,minmax(350px,1fr))] gap-8">
        @for (tv of devices(); track tv.ip) {
          <div
            class="group flex flex-col gap-6 rounded-[12px] border border-white/5 bg-mimir-card p-6 transition-transform duration-300 ease-in-out hover:-translate-y-1.25 hover:border-mimir-primary/30"
          >
            <div class="flex flex-col">
              <span
                class="mb-2 self-start rounded-[4px] bg-white/10 px-[0.6rem] py-1 text-[0.7rem] font-extrabold uppercase"
                [ngClass]="{
                  'text-[#5bc0de]': tv.brand === 'Sony',
                  'text-[#f0ad4e]': tv.brand === 'Samsung',
                  'text-[#d9534f]': tv.brand === 'LG',
                }"
              >
                {{ tv.brand }}
              </span>
              <h2 class="m-0 text-[1.25rem]">{{ tv.name }}</h2>
              <p class="my-1 text-[0.9rem] text-mimir-muted">{{ tv.model }}</p>
              <p class="m-0 font-mono text-[0.85rem] text-mimir-primary">{{ tv.ip }}</p>
            </div>

            <div>
              <h3 class="mb-4 text-[0.85rem] uppercase text-mimir-muted">Remote Controls</h3>
              <div class="flex flex-wrap gap-2">
                @for (cmd of tv.commands; track cmd) {
                  <button
                    class="cursor-pointer rounded-[6px] border border-white/5 bg-white/5 px-[0.8rem] py-[0.4rem] text-[0.85rem] text-white transition-all duration-150 hover:border-mimir-primary hover:bg-[#334155] active:scale-95 active:bg-mimir-primary"
                    (click)="sendCommand(tv.ip, cmd)"
                  >
                    {{ cmd }}
                  </button>
                }
              </div>
            </div>

            <div class="mt-auto border-t border-white/5 pt-4 text-[0.75rem] text-mimir-muted">
              <span>Seen: {{ tv.lastFound | date: 'HH:mm:ss' }}</span>
            </div>
          </div>
        } @empty {
          <div
            class="col-span-full rounded-[12px] border-2 border-dashed border-white/5 bg-white/5 py-20 text-center"
          >
            <p>No TVs discovered yet.</p>
            <p class="text-[0.9rem] text-mimir-muted">
              Make sure your TVs are on and connected to the same network.
            </p>
          </div>
        }
      </div>
    }
  </main>

  @if (scanning()) {
    <div
      class="fixed bottom-8 right-8 flex animate-slideIn flex-col gap-2 rounded-[12px] bg-mimir-primary px-8 py-4 shadow-2xl"
    >
      <div class="relative h-[3px] overflow-hidden rounded-[2px] bg-white/30">
        <div class="absolute left-0 top-0 h-full w-1/2 animate-progress bg-white"></div>
      </div>
      <span>SSDP Discovery in progress...</span>
    </div>
  }
</div>
<router-outlet />
